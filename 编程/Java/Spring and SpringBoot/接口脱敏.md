
[GitHub代码示例](https://github.com/XuFeiLife/springboot-demo/tree/master/src/main/java/com/hans/springboot/demo/senstive)

基于Spring Boot Demo 实现步骤：

# 1. 定义脱敏策略枚举

首先，我们定义不同字段的脱敏规则（如手机号、身份证、姓名）。

```java
public enum SensitiveStrategy {
    /** 姓名：只显示第一个汉字 */
    USERNAME(s -> s.replaceAll("(\\S)\\S+", "$1**")),
    /** 手机号：保留前3后4 */
    PHONE(s -> s.replaceAll("(\\d{3})\\d{4}(\\d{4})", "$1****$2")),
    /** 身份证：保留前6后4 */
    ID_CARD(s -> s.replaceAll("(\\d{6})\\d{8,11}(\\d{4})", "$1**********$2"));
    

    private final Function<String, String> desensitizer;

    SensitiveStrategy(Function<String, String> desensitizer) {
        this.desensitizer = desensitizer;
    }

    public String desensitize(String origin) {
        return desensitizer.apply(origin);
    }
}
```

# 2. 自定义脱敏注解

创建一个注解，用于标注在需要脱敏的字段上。
```java
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.FIELD)
@JacksonAnnotationsInside // 标明这是一个Jackson复合注解
@JsonSerialize(using = SensitiveSerializer.class) // 指定序列化器
public @interface Sensitive {
    SensitiveStrategy strategy();
}
```

# 3. 编写 Jackson 序列化逻辑

这是核心部分。通过继承 `JsonSerializer`，我们在 Jackson 将对象转为 JSON 的那一刻进行正则替换。

```java
public class SensitiveSerializer extends JsonSerializer<String> implements ContextualSerializer {
    private SensitiveStrategy strategy;

    @Override
    public void serialize(String value, JsonGenerator gen, SerializerProvider serializers) throws IOException {
        gen.writeString(strategy.desensitize(value));
    }

    @Override
    public JsonSerializer<?> createContextual(SerializerProvider prov, BeanProperty property) {
        // 获取字段上的注解信息
        Sensitive annotation = property.getAnnotation(Sensitive.class);
        if (annotation != null) {
            this.strategy = annotation.strategy();
            return this;
        }
        return prov.findValueSerializer(property.getType(), property);
    }
}
```

# 4. 在实体类（VO/DTO）中使用

现在，你只需要在返回给前端的对象字段上添加注解。

```java
public class UserVO {
    private Long id;
    
    @Sensitive(strategy = SensitiveStrategy.USERNAME)
    private String name;

    @Sensitive(strategy = SensitiveStrategy.PHONE)
    private String mobile;

    // 省略 Getter/Setter/Constructor
    public UserVO(Long id, String name, String mobile) {
        this.id = id;
        this.name = name;
        this.mobile = mobile;
    }
}
```

# 5. 编写 Controller 测试

```java
@RestController
@RequestMapping("/user")
public class UserController {

    @GetMapping("/info")
    public UserVO getUser() {
        // 模拟原始数据
        return new UserVO(1L, "张三丰", "13812345678");
    }
}
```

当你访问 `/user/info` 时，Jackson 会自动处理字段，前端收到的 JSON 如下：

```json
{
  "id": 1,
  "name": "张**",
  "mobile": "138****5678"
}
```

