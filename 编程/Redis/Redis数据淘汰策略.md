[**概念**](#**概念**)
[**触发条件**](#**触发条件**)
[**淘汰策略机制**](#**淘汰策略机制**)
[**核心算法解析**](#**核心算法解析**)
[**如何选择**](#**如何选择**)
### **概念**

Redis 的数据淘汰策略（Eviction Policies）是指当 Redis 的 **内存使用达到上限**（`maxmemory`）时，为了腾出空间给新数据，系统如何选择并删除旧数据的机制。

### **触发条件**

1. 设置了maxmemory
2. 写入新数据，但可用内存不足

### **淘汰策略机制**

#### **1.  无淘汰机制**

**noeviction** (默认策略)：不删除任何数据。当内存满时，新的写入请求（如 `SET`, `LPUSH` 等）会返回错误，但读请求和 `DEL` 请求可以继续执行。适用于缓存数据非常关键、绝不允许丢失的场景。

### **2. 针对设置了过期时间的数据 (`volatile-*`)**

Redis只在设置了TTL的数据中筛选
1. volatile-lru：利用LRU算法筛选设置了过期时间的数据
2. volatile-lfu：利用LFU算法筛选设置了过期时间的数据
3. volatile-random：随机筛选设置了过期时间的数据
4. volatile-ttl：优先删除剩余存活时间最短的数据

### **3. 针对所有数据 (`allkeys-*`)**

Redis会在所有的数据集进行筛选，无论是否设置了TTL
1. **allkeys-lru**：对全体 key 运行 LRU 算法。
2. allkeys-lfu：对全体 key 运行 LFU 算法。==纯缓存==
3. allkeys-random：随机筛选并删除。

### **核心算法解析**

**1. LRU (Least Recently Used) - 最近最少使用**

根据数据的**访问时间**来淘汰。如果一条数据最近很久没被访问过，那么未来被访问的概率也较低。Redis 并非记录所有数据的精确访问链表，而是通过随机采样（默认采样 5 个 key），然后剔除样本中最久未访问的那个。

**2.LFU (Least Frequently Used) - 最不经常使用**

根据数据的**访问频次**来淘汰。如果一条数据访问频率极高，即便它最近一秒没被访问，也不该被删除。Redis 在 4.0 后引入，通过计数器记录访问次数，并随时间推移进行衰减。

### **如何选择**

| **场景**                    | **推荐策略**                        |
| ------------------------- | ------------------------------- |
| **读写分布均匀，且有明显的冷热数据之分**    | `allkeys-lru`                   |
| **某些数据访问频率远高于其他数据**       | `allkeys-lfu`                   |
| **希望通过代码逻辑（过期时间）精准控制缓存**  | `volatile-ttl` 或 `volatile-lru` |
| **请求呈完全随机分布**             | `allkeys-random`                |
| **Redis 作为数据库使用，绝对不能丢数据** | `noeviction`                    |


